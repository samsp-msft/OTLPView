@page "/"

<PageTitle>Logs</PageTitle>

@if (_logEntries is null or { Count: 0 })
{
    <SimpleBanner TitleText="No logs found"
                  BodyText="As logs are written, they will be displayed here." />
}
else
{
    <MudTable Items="@_logEntries" Dense="true" Hover="true" Virtualize="true"
              Filter="new Func<OtlpLogEntry, bool>(OnApplyFilter)">
        <ToolBarContent>
            <MudText Typo="Typo.h6">Log Entries</MudText>
            <MudSpacer />
            <MudTextField @bind-Value="_filter" Clearable="true" Placeholder="Filter"
                Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <HeaderContent>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.Application.ShortApplicationName)">Name</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.Severity)">Severity</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.TimeStamp)">Timestamp</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.OriginalFormat)">Format</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.SpanId)">Span</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<OtlpLogEntry, object>(x => x.TraceId)">Trace Id</MudTableSortLabel></MudTh>
            <MudTh>Properties</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Name">@context.Application.ShortApplicationName.HtmlEncode()</MudTd>
            <MudTd DataLabel="Severity">@context.Severity</MudTd>
            <MudTd DataLabel="Timestamp">@context.TimeStamp.ToLocalTime()</MudTd>
            <MudTd DataLabel="Format">@context.OriginalFormat</MudTd>
            <MudTd DataLabel="Span">@context.SpanId</MudTd>
            <MudTd DataLabel="Trace Id">
                <MudLink OnClick="@(() => OnFilterByTraceId(context.TraceId))" Underline="Underline.Always">
                    @context.TraceId
                </MudLink>
            </MudTd>
            <MudTd DataLabel="Properties">
                @if (HasLogData)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Preview"
                                   Color="Color.Primary" Size="Size.Large"
                                   OnClick="(async () => await OnShowProperties(context))">
                    </MudIconButton>
                }
                else
                {
                    <MudIcon Icon="@Icons.Material.Filled.DoNotDisturb"
                             Color="Color.Error" Size="Size.Large">
                    </MudIcon>
                }
            </MudTd>
        </RowTemplate>
        <PagerContent>
            <MudTablePager />
        </PagerContent>
    </MudTable>
}
